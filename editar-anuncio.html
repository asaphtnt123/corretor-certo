<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Anúncio</title>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Editar Anúncio</h1>
    <form id="form-editar">
        <label for="titulo">Título:</label>
        <input type="text" id="titulo" required>
        
        <label for="descricao">Descrição:</label>
        <textarea id="descricao" required></textarea>
        
        <label for="preco">Preço:</label>
        <input type="number" id="preco" required>
        
        <button type="submit">Salvar Alterações</button>
    </form>

    <script type="module">
       // Importar funções do Firebase corretamente (versão consolidada)
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { 
  getAuth, 
  onAuthStateChanged,
  setPersistence,
  browserLocalPersistence,
  signOut
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { 
  getFirestore,
  collection,
  query,
  where,
  getDocs,
  doc,
  getDoc,
  setDoc,
  addDoc,
  updateDoc
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
import { getStorage } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";

// Configuração do Firebase
const firebaseConfig = {
  apiKey: "AIzaSyA-7HOp-Ycvyf3b_03ev__8aJEwAbWSQZY",
  authDomain: "connectfamilia-312dc.firebaseapp.com",
  projectId: "connectfamilia-312dc",
  storageBucket: "connectfamilia-312dc.appspot.com",
  messagingSenderId: "797817838649",
  appId: "1:797817838649:web:1aa7c54abd97661f8d81e8",
  measurementId: "G-QKN9NFXZZQ"
};

// Inicializar Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);  // Adicionei esta linha que estava faltando
const auth = getAuth(app);
const storage = getStorage(app);

// Ativar persistência da autenticação
setPersistence(auth, browserLocalPersistence)
  .then(() => console.log("Persistência ativada!"))
  .catch((error) => console.error("Erro na persistência:", error));

console.log("Firebase inicializado com sucesso!");

export { app, db, auth, storage };
        // Captura os parâmetros da URL
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');
        const tipo = urlParams.get('tipo');
        const collectionName = tipo === "imovel" ? "imoveis" : "automoveis";

        async function carregarDadosAnuncio() {
            const docRef = doc(db, collectionName, id);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                const anuncio = docSnap.data();
                document.getElementById("titulo").value = anuncio.titulo;
                document.getElementById("descricao").value = anuncio.descricao;
                document.getElementById("preco").value = anuncio.preco;
            } else {
                alert("Anúncio não encontrado!");
                window.location.href = "perfil.html";
            }
        }

        document.addEventListener("DOMContentLoaded", carregarDadosAnuncio);

        document.getElementById("form-editar").addEventListener("submit", async function(event) {
            event.preventDefault();
            const titulo = document.getElementById("titulo").value;
            const descricao = document.getElementById("descricao").value;
            const preco = document.getElementById("preco").value;
            
            try {
                await updateDoc(doc(db, collectionName, id), {
                    titulo: titulo,
                    descricao: descricao,
                    preco: parseFloat(preco)
                });
                alert("Anúncio atualizado com sucesso!");
                window.location.href = "perfil.html";
            } catch (error) {
                console.error("Erro ao atualizar anúncio:", error);
                alert("Erro ao atualizar anúncio.");
            }
        });
    </script>
</body>
</html>
