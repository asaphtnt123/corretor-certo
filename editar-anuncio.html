<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Anúncio</title>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Editar Anúncio</h1>
    <form id="form-editar">
        <label for="titulo">Título:</label>
        <input type="text" id="titulo" required>
        
        <label for="descricao">Descrição:</label>
        <textarea id="descricao" required></textarea>
        
        <label for="preco">Preço:</label>
        <input type="number" id="preco" required>
        
        <button type="submit">Salvar Alterações</button>
    </form>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_AUTH_DOMAIN",
            projectId: "SEU_PROJECT_ID",
            storageBucket: "SEU_STORAGE_BUCKET",
            messagingSenderId: "SEU_MESSAGING_SENDER_ID",
            appId: "SEU_APP_ID"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Captura os parâmetros da URL
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');
        const tipo = urlParams.get('tipo');
        const collectionName = tipo === "imovel" ? "imoveis" : "automoveis";

        async function carregarDadosAnuncio() {
            const docRef = doc(db, collectionName, id);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                const anuncio = docSnap.data();
                document.getElementById("titulo").value = anuncio.titulo;
                document.getElementById("descricao").value = anuncio.descricao;
                document.getElementById("preco").value = anuncio.preco;
            } else {
                alert("Anúncio não encontrado!");
                window.location.href = "perfil.html";
            }
        }

        document.addEventListener("DOMContentLoaded", carregarDadosAnuncio);

        document.getElementById("form-editar").addEventListener("submit", async function(event) {
            event.preventDefault();
            const titulo = document.getElementById("titulo").value;
            const descricao = document.getElementById("descricao").value;
            const preco = document.getElementById("preco").value;
            
            try {
                await updateDoc(doc(db, collectionName, id), {
                    titulo: titulo,
                    descricao: descricao,
                    preco: parseFloat(preco)
                });
                alert("Anúncio atualizado com sucesso!");
                window.location.href = "perfil.html";
            } catch (error) {
                console.error("Erro ao atualizar anúncio:", error);
                alert("Erro ao atualizar anúncio.");
            }
        });
    </script>
</body>
</html>
 
